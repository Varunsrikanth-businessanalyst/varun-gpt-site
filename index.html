<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Varun-GPT</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0E0F12; --ink:#ECEDEE; --muted:#9AA0A6;
  --panel:#16181D; --panel2:#202124; --stroke:#2A2B32;
  --pill:#2A2B32; --pillStroke:#3A3B44; --accent:#7F8FFF;
  --red:#ff5a5f; --shadow:0 10px 28px rgba(0,0,0,.40);
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;overflow-x:hidden}

.wrap{max-width:980px;margin:0 auto;padding:56px 20px 36px}
.hero{min-height:74vh;display:flex;flex-direction:column;justify-content:center;align-items:center}

h1{font-size:clamp(34px,4.6vw,58px);font-weight:800;margin:0 0 14px;text-align:center;line-height:1.06;letter-spacing:-.01em}
h1 .l1, h1 .l2{display:block}
.sub{text-align:center;color:var(--muted);margin:0 0 20px;font-size:clamp(14px,1.45vw,18px);line-height:1.35}
.sub .s1,.sub .s2{display:block}
.pm{color:#ff5a5f;font-weight:800}

.actions{display:flex;gap:12px;justify-content:center;margin:10px 0 14px;flex-wrap:wrap}
.btn{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border-radius:999px;border:1px solid var(--stroke);background:var(--panel);color:var(--ink);text-decoration:none;font-weight:700;font-size:13px;transition:transform .15s ease,border-color .15s ease}
.btn:hover{border-color:#3a3b44;transform:translateY(-1px)}

.label{color:var(--muted);text-align:center;font-weight:700;margin:6px 0 8px;font-size:13px;letter-spacing:.2px}
.search{display:flex;gap:10px;align-items:center;margin:8px auto 10px;max-width:940px;width:100%}
.bar{flex:1;background:var(--pill);border:1px solid var(--pillStroke);border-radius:26px;padding:16px 18px;font-size:16px;color:var(--ink);outline:none;box-shadow:var(--shadow)}
.send{width:46px;height:46px;border-radius:999px;border:1px solid var(--pillStroke);background:var(--pill);cursor:pointer;color:#fff;font-size:16px;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow);transition:transform .15s ease, background .2s ease}
.send:hover{background:#3A3B44} .send:active{transform:scale(.96) rotate(12deg)}

.chips{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin:10px auto 0;max-width:940px}
.chip{background:var(--pill);border:1px solid var(--pillStroke);color:var(--ink);padding:10px 14px;border-radius:999px;font-weight:700;font-size:13px;cursor:pointer;transition:transform .12s ease, border-color .15s ease}
.chip:hover{transform:translateY(-1px);border-color:#3a3b44}
.chip:active{transform:scale(.98)}

.chatwrap{display:none;margin:18px auto 28px;max-width:940px}
.card{background:var(--panel);border:1px solid var(--stroke);border-radius:16px;padding:8px}
.chat{max-height:60vh;overflow:auto;background:var(--panel2);border-radius:12px;border:1px solid var(--stroke);padding:8px}
.row{display:flex;margin:8px 0}
.bubble{max-width:72%;padding:10px 14px;border-radius:14px;white-space:pre-wrap;line-height:1.45;font-size:14px;position:relative}
.me .bubble{margin-left:auto;background:#2F3A4A;color:#fff;border-bottom-right-radius:6px}
.bot .bubble{background:#16181D;border:1px solid var(--stroke)}

.chat-on .hero{min-height:0;justify-content:flex-start}
</style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1><span class="l1">Welcome to Varun-</span><span class="l2">GPT</span></h1>
      <p class="sub">
        <span class="s1">Ask anything about Varun's <span class="pm">Product Management</span>,</span>
        <span class="s2">life, interests and goals.</span>
      </p>

      <div class="actions">
        <a class="btn" href="resume.pdf" target="_blank">Resume</a>
        <a class="btn" href="https://varunthinksproduct.framer.website/" target="_blank">Portfolio</a>
        <a class="btn" href="https://www.linkedin.com/in/varun-srikanth/" target="_blank">LinkedIn</a>
      </div>

      <div class="label">Ask Varun-GPT</div>

      <div class="search">
        <input id="q" class="bar" placeholder="Want to know more about Varun? Ask away…">
        <button class="send" id="send" title="Ask">➤</button>
      </div>

      <div class="chips" id="chips"></div>
    </div>

    <div class="chatwrap" id="chatwrap">
      <section class="card">
        <div class="chat" id="chat"></div>
      </section>
    </div>
  </div>

<script>
/* ================== Core facts ================== */
const BIRTH_YEAR = 1996;
const AGE = new Date().getFullYear() - BIRTH_YEAR;

/* ================== Knowledge Base ================== */
const KB = [ /* … keep your KB entries here … */ ];

/* ================== Router ================== */
const norm = s => String(s||"").toLowerCase();
function includesAny(s, arr){ s = norm(s); return arr.some(k=> s.includes(norm(k))); }
const get = key => (KB.find(i => i.key === key) || {}).a || "";
function route(raw){ /* … your existing route logic … */ }

/* ================== Wire up UI ================== */
const chat = document.getElementById("chat");
const chatwrap = document.getElementById("chatwrap");
const qEl = document.getElementById("q");
const sendBtn = document.getElementById("send");
const chips = document.getElementById("chips");

const SUGGESTIONS = [
  "Varun's Introduction",
  "What roles is Varun targeting?",
  "Varun's top projects",
  "What is Varun expecting in next roles?"
];
SUGGESTIONS.forEach(t=>{
  const b=document.createElement("button");
  b.className="chip"; b.textContent=t;
  b.onclick=()=>sendQuery(t);
  chips.appendChild(b);
});

function ensureChatVisible(){
  if(chatwrap.style.display!=="block"){
    chatwrap.style.display="block";
    document.body.classList.add("chat-on");
  }
}
function row(role, nodeOrText){
  ensureChatVisible();
  const r=document.createElement("div"); r.className="row "+role;
  const b=document.createElement("div"); b.className="bubble";
  if(nodeOrText instanceof Node) b.appendChild(nodeOrText); else b.textContent=nodeOrText;
  r.appendChild(b); chat.appendChild(r); chat.scrollTop=chat.scrollHeight;
}
function typingNode(){ const c=document.createElement("div"); c.className="typing"; c.innerHTML='<span class="dot"></span><span class="dot"></span><span class="dot"></span>'; return c; }
function typeText(el,text,speed=12){ return new Promise(res=>{ let i=0; const tick=()=>{ el.textContent+=text[i++]; chat.scrollTop=chat.scrollHeight; if(i<text.length) setTimeout(tick,speed); else res(); }; tick(); }); }

async function askLLM(prompt){
  const res = await fetch('/.netlify/functions/ask',{
    method:'POST', headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ prompt })
  });
  const data = await res.json();
  if(!res.ok) throw new Error(data.error||'LLM call failed');
  return data.answer || data.output || 'No answer';
}

async function sendQuery(text){
  const t=(text||qEl.value||"").trim();
  if(!t) return;
  qEl.value=""; row("me", t);

  const tn=typingNode(); row("bot", tn);
  try{
    const kbReply=route(t);
    const needsLLM=!kbReply||kbReply.startsWith("I didn’t find")||kbReply.startsWith("I didn't find");
    const finalAnswer=needsLLM?await askLLM(t):kbReply;
    const lastRow=tn.parentElement.parentElement;
    lastRow.remove();
    const holder=document.createElement("span");
    row("bot",holder);
    await typeText(holder,finalAnswer,11);
  }catch(err){
    console.error(err);
    const lastRow=tn.parentElement.parentElement;
    lastRow.remove();
    row("bot","Hmm, something went wrong contacting the AI. Please try again.");
  }
}

// Attach handlers outside function
sendBtn.onclick=()=>sendQuery();
qEl.addEventListener("keydown",e=>{ if(e.key==="Enter") sendQuery(); });
</script>
</body>
</html>
